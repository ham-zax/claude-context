<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Satori | Architecture</title>
    <meta
      name="description"
      content="How Satori works under the hood — from file change to agent result: packages/core trust layer, packages/mcp runtime, vector store, call-graph sidecar, and deterministic six-tool MCP surface."
    />
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
      media="(min-width: 921px)"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
      media="(min-width: 921px)"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@100;400;700&display=swap"
      rel="stylesheet"
      media="(min-width: 921px)"
    />
    <style>
      :root {
        --bg: #000000;
        --panel: rgba(10, 10, 10, 0.85);
        --fg: #ffffff;
        --muted: rgba(255, 255, 255, 0.55);
        --line: rgba(255, 255, 255, 0.15);
        --accent: #dfff00; /* Radioactive Chartreuse */
        --accent-dim: rgba(223, 255, 0, 0.15);
        --serif: "Cormorant Garamond", serif;
        --sans: "Inter", sans-serif;
        --mono: "JetBrains Mono", monospace;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        cursor: crosshair;
      }

      body {
        min-height: 100vh;
        color: var(--fg);
        font-family: var(--sans);
        background-color: var(--bg);
        background-image:
          linear-gradient(var(--line) 1px, transparent 1px),
          linear-gradient(90deg, var(--line) 1px, transparent 1px);
        background-size: 50px 50px;
        background-position: center center;
        line-height: 1.6;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
      }

      ::selection {
        background: var(--accent);
        color: #060607;
      }

      .container {
        max-width: 1140px;
        margin: 0 auto;
        padding: 1rem 1rem 4rem;
      }

      nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        border: 1px solid var(--line);
        padding: 1.2rem 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-size: 0.75rem;
        font-family: var(--mono);
        background: var(--bg);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 1rem;
        z-index: 100;
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        background: var(--accent);
        border-radius: 50%;
        box-shadow: 0 0 10px var(--accent);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(0.9);
        }
      }

      .nav-links {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
      }

      a {
        color: var(--fg);
        text-decoration: none;
        transition: color 0.2s;
      }

      a:hover {
        color: var(--accent);
      }

      .hero {
        margin-top: 2rem;
        border: 1px solid var(--line);
        padding: 5rem 2rem;
        background: var(--bg);
        backdrop-filter: blur(10px);
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        transition: border-color 0.3s;
      }

      .hero:hover {
        border-color: var(--accent);
        box-shadow: 0 0 40px var(--accent-dim);
      }

      h1 {
        font-family: var(--serif);
        font-size: clamp(3rem, 8vw, 6rem);
        line-height: 0.9;
        font-weight: 300;
        letter-spacing: -0.04em;
        transition:
          color 0.2s,
          text-shadow 0.2s;
      }

      h1:hover {
        color: var(--accent);
        text-shadow: 0 0 60px var(--accent-dim);
      }

      .hero p {
        margin-top: 1.5rem;
        max-width: 800px;
        color: var(--muted);
        font-size: 1.1rem;
        font-weight: 300;
      }

      .hero p .sel {
        display: inline-block;
        padding: 0.02rem 0.24rem;
        margin: 0 0.06rem;
        border-radius: 0.14rem;
        line-height: 1.35;
      }

      .hero p .sel-core {
        background: rgba(105, 216, 255, 0.22);
        color: #bdefff;
      }

      .hero p .sel-mcp {
        background: rgba(223, 255, 0, 0.22);
        color: #eaff9b;
      }

      .hero p .sel-safety {
        background: rgba(255, 140, 107, 0.22);
        color: #ffc5b5;
      }

      .hero p .sel-data {
        background: rgba(180, 142, 255, 0.24);
        color: #d8beff;
      }

      .hero-meta {
        margin-top: 2rem;
        font-family: var(--mono);
        font-size: 0.75rem;
        color: var(--accent);
        text-transform: uppercase;
        letter-spacing: 0.15em;
      }

      .section {
        margin-top: 1rem;
        border: 1px solid var(--line);
        background: var(--bg);
        padding: 4rem 2rem;
        position: relative;
        transition: border-left-color 0.3s;
      }

      .section:hover {
        border-left: 2px solid var(--accent);
      }

      h2 {
        font-family: var(--serif);
        font-size: clamp(2rem, 5vw, 3.5rem);
        line-height: 0.95;
        font-weight: 300;
        margin-bottom: 1rem;
      }

      .intro {
        font-family: var(--sans);
        font-size: 1.1rem;
        font-weight: 300;
        color: var(--muted);
        max-width: 800px;
        margin-bottom: 2.5rem;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 1rem;
      }

      .card {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.01);
        padding: 2rem;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
      }

      .card:hover {
        border-color: var(--accent);
        background: rgba(223, 255, 0, 0.02);
        transform: translateY(-2px);
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background: var(--accent);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
      }

      .card:hover::before {
        transform: scaleX(1);
      }

      .card h3 {
        font-family: var(--mono);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: var(--accent);
        margin-bottom: 1rem;
      }

      .card p,
      .card li {
        font-family: var(--sans);
        color: var(--muted);
        font-size: 0.95rem;
        font-weight: 300;
        line-height: 1.6;
      }

      .card ul {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .card li {
        padding-left: 1rem;
        position: relative;
      }

      .card li::before {
        content: ">>";
        position: absolute;
        left: 0;
        color: var(--accent);
        opacity: 0.5;
        font-family: var(--mono);
        font-size: 0.8rem;
      }

      .runtime-card {
        border-color: rgba(255, 255, 255, 0.2);
      }

      .runtime-card h3 {
        color: var(--runtime-accent);
      }

      .runtime-card li::before {
        color: var(--runtime-accent);
        opacity: 0.9;
      }

      .runtime-card li {
        padding-left: 1.7rem;
      }

      .runtime-card code {
        color: var(--runtime-accent);
        background: var(--runtime-bg);
      }

      .runtime-mcp {
        --runtime-accent: #dfff00;
        --runtime-bg: rgba(223, 255, 0, 0.08);
        --runtime-line: rgba(223, 255, 0, 0.35);
      }

      .runtime-core {
        --runtime-accent: #69d8ff;
        --runtime-bg: rgba(105, 216, 255, 0.1);
        --runtime-line: rgba(105, 216, 255, 0.35);
      }

      .table-wrap {
        margin-top: 2rem;
        overflow-x: auto;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.01);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 760px;
      }

      th,
      td {
        border-bottom: 1px solid var(--line);
        padding: 1rem 1.5rem;
        text-align: left;
        vertical-align: top;
        font-size: 0.9rem;
        font-family: var(--sans);
        font-weight: 300;
      }

      th {
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-size: 0.75rem;
        color: var(--accent);
        background: rgba(0, 0, 0, 0.4);
        font-family: var(--mono);
      }

      td code {
        color: var(--accent);
        background: rgba(223, 255, 0, 0.05);
        padding: 0.2rem 0.4rem;
        font-size: 0.8rem;
      }

      pre {
        margin: 1rem 0 0 0;
        border: 1px solid var(--line);
        background: rgba(0, 0, 0, 0.6);
        padding: 1rem;
        overflow-x: auto;
        font-size: 0.8rem;
        line-height: 1.6;
        white-space: pre;
        color: var(--muted);
      }

      pre::-webkit-scrollbar,
      .diagram-wrap::-webkit-scrollbar,
      .table-wrap::-webkit-scrollbar {
        height: 4px;
      }

      pre::-webkit-scrollbar-thumb,
      .diagram-wrap::-webkit-scrollbar-thumb,
      .table-wrap::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
      }

      .diagram-wrap {
        margin-top: 2rem;
        border: 1px solid var(--line);
        background: rgba(0, 0, 0, 0.4);
        padding: 2rem;
        overflow-x: auto;
        display: flex;
        justify-content: center;
      }

      .mermaid {
        min-width: 760px;
      }

      code {
        font-family: var(--mono);
      }

      .details-list {
        margin-top: 2rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      details {
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.01);
        transition: border-color 0.2s;
      }

      details:hover {
        border-color: rgba(223, 255, 0, 0.3);
      }

      summary {
        cursor: pointer;
        list-style: none;
        padding: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-size: 0.85rem;
        font-family: var(--mono);
        color: var(--accent);
      }

      summary::-webkit-details-marker {
        display: none;
      }

      .details-body {
        border-top: 1px dotted var(--line);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .details-body pre {
        margin-top: 0;
      }

      .btn {
        border: 1px solid var(--fg);
        background: transparent;
        color: var(--fg);
        font-family: var(--mono);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        padding: 0.6rem 1rem;
        cursor: pointer;
        width: fit-content;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .btn:hover {
        background: var(--accent);
        color: var(--bg);
        border-color: var(--accent);
        box-shadow: 0 0 20px var(--accent-dim);
        font-weight: 700;
      }

      .footer {
        margin-top: 1rem;
        border: 1px solid var(--line);
        background: var(--bg);
        padding: 1.5rem 2rem;
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        flex-wrap: wrap;
        color: var(--muted);
        font-size: 0.85rem;
        font-family: var(--sans);
        font-weight: 300;
      }

      @media (max-width: 920px) {
        :root {
          --serif: ui-serif, Georgia, serif;
          --sans:
            system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
            Arial, sans-serif;
          --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        }

        * {
          cursor: auto;
        }

        body {
          background-image: none;
        }

        nav {
          backdrop-filter: none;
        }

        .status-dot {
          animation: none;
          box-shadow: none;
        }

        .hero,
        .card,
        .btn,
        .section,
        details,
        a {
          transition: none !important;
        }

        .hero:hover,
        .card:hover,
        .btn:hover {
          box-shadow: none;
          transform: none;
        }

        .section:hover {
          border-left: 1px solid var(--line);
        }

        details:hover {
          border-color: var(--line);
        }

        .grid-2 {
          grid-template-columns: 1fr;
        }

        .hero {
          padding: 4rem 1.5rem;
        }

        .section {
          padding: 3rem 1.5rem;
        }

        .card {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <nav>
        <div class="nav-brand">
          <div class="status-dot"></div>
          <span>Satori // Architecture // Six Tools • One Workflow</span>
        </div>
        <div class="nav-links">
          <a href="https://satori-mcp.vercel.app" target="_blank">[ Live ]</a>
          <a href="index.html">[ Landing ]</a>
          <a href="https://github.com/ham-zax/satori" target="_blank"
            >[ Repository ]</a
          >
          <a
            href="https://github.com/ham-zax/satori/blob/main/ARCHITECTURE.md"
            target="_blank"
            >[ Source Doc ]</a
          >
          <a
            href="https://github.com/ham-zax/satori/blob/main/packages/mcp/README.md"
            target="_blank"
            >[ MCP Spec ]</a
          >
        </div>
      </nav>

      <section class="hero">
        <h1>Satori Architecture</h1>
        <p>
          Two packages work in concert:
          <span class="sel sel-core"><code>packages/core</code></span> is the
          <span class="sel sel-core">trust layer</span>
          (<span class="sel sel-safety">merkle/hash-on-change sync</span>,
          <span class="sel sel-safety">partial-scan safety</span>,
          <span class="sel sel-safety">path-normalization SSOT</span>).
          <span class="sel sel-mcp"><code>packages/mcp</code></span> is the
          agent interface
          (<span class="sel sel-mcp">six-tool contract</span>,
          <span class="sel sel-mcp">freshness gating</span>,
          <span class="sel sel-mcp">search orchestration</span>,
          <span class="sel sel-mcp">sidecar lifecycle</span>,
          <span class="sel sel-safety">snapshot/fingerprint gates</span>).
          <span class="sel sel-data">Zilliz Cloud (Milvus)</span> and a
          <span class="sel sel-data">call-graph sidecar</span> provide the
          <span class="sel sel-data">retrieval substrate</span>.
        </p>
        <div class="hero-meta">
          Six MCP tools • Sync-on-read for search • Fingerprint gates • Merkle
          incremental sync • Call-graph sidecar
        </div>
        <div class="hero-meta">
          Six tools = six eyes into your repo: search → outline → graph → read.
        </div>
      </section>

      <section class="section">
        <h2>System Overview</h2>
        <p class="intro">
          Agent requests route through a fixed six-tool registry. The MCP
          runtime enforces freshness/fingerprint gates and orchestrates search.
          Core sync provides deterministic file-state truth for indexing.
        </p>
        <div class="diagram-wrap">
          <div class="mermaid">
flowchart TD
    client["Agent<br/>Claude / Codex / Cursor"]
    registry["Tool Registry<br/>(6 MCP tools)"]
    mcp["packages/mcp Runtime<br/>ToolHandlers<br/>Search Orchestration<br/>Freshness Gate<br/>Snapshot + Fingerprint Gates"]
    vector["Zilliz / Milvus<br/>Vector Store"]
    sidecar["Call-Graph Sidecar<br/>AST graph artifacts"]
    core["packages/core<br/>File Sync / Merkle / Hash"]

    client --> registry
    registry --> mcp
    mcp --> vector
    mcp --> sidecar
    mcp --> core
          </div>
        </div>
      </section>

      <section class="section">
        <h2>Runtime Boundaries</h2>
        <div class="grid-2">
          <article class="card runtime-card runtime-mcp">
            <h3>MCP Runtime (@zokizuan/satori-mcp)</h3>
            <ul>
              <li>Owns the six-tool MCP contract and schema validation.</li>
              <li>
                Runs freshness gating: sync-on-read is executed for
                <code>search_codebase</code>.
              </li>
              <li>
                Applies snapshot/fingerprint compatibility gates with
                deterministic <code>requires_reindex</code> envelopes.
              </li>
              <li>
                Schedules background periodic sync and optional debounced
                watcher sync.
              </li>
              <li>
                Reconciles <code>.satoriignore</code>/<code>.gitignore</code>
                edits without full reindex.
              </li>
              <li>
                Reconciles cloud snapshot metadata before handler execution to
                keep local state aligned.
              </li>
              <li>
                Manages sidecar lifecycle and fallback behavior when graph data
                is unavailable.
              </li>
            </ul>
          </article>
          <article class="card runtime-card runtime-core">
            <h3>Core Engine (@zokizuan/satori-core)</h3>
            <ul>
              <li>
                Maintains the sync trust layer: stat-first, hash-on-change,
                deterministic merkle root.
              </li>
              <li>
                Preserves prior entries under partial scans (unreadable files
                and directories).
              </li>
              <li>
                Enforces path normalization SSOT for scan/snapshot/diff flows.
              </li>
              <li>
                Re-embeds only changed files for incremental indexing
                performance.
              </li>
              <li>
                Performs AST-aware chunking/splitting and remains MCP-agnostic.
              </li>
            </ul>
          </article>
        </div>
      </section>

      <section class="section">
        <h2>Tool Surface</h2>
        <p class="intro">
          Satori intentionally exposes only six MCP tools to reduce routing
          ambiguity while keeping call-chain traversal and file navigation
          first-class.
        </p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tool</th>
                <th>Purpose</th>
                <th>Key Params</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>list_codebases</code></td>
                <td>Inventory tracked roots and indexing state.</td>
                <td>None</td>
                <td>
                  Deterministic bucket order with lexicographically sorted paths
                  per bucket.
                </td>
              </tr>
              <tr>
                <td><code>manage_index</code></td>
                <td>Index lifecycle and recovery operations.</td>
                <td>
                  <code>action</code>, <code>path</code>, optional
                  <code>force</code>, <code>customExtensions</code>,
                  <code>ignorePatterns</code>, <code>zillizDropCollection</code>
                </td>
                <td>
                  Actions: <code>create|reindex|sync|status|clear</code>. No
                  public splitter knob.
                </td>
              </tr>
              <tr>
                <td><code>search_codebase</code></td>
                <td>
                  Runtime-first semantic search with grouped/raw output.
                </td>
                <td>
                  <code>query</code>, <code>scope</code>,
                  <code>resultMode</code>, <code>groupBy</code>,
                  <code>rankingMode</code>, <code>limit</code>, optional
                  <code>debug</code>
                </td>
                <td>
                  Defaults:
                  <code>scope=runtime,resultMode=grouped,groupBy=symbol,rankingMode=auto_changed_first</code>.
                  Includes <code>freshnessDecision</code> and grouped
                  <code>callGraphHint</code>.
                </td>
              </tr>
              <tr>
                <td><code>file_outline</code></td>
                <td>Sidecar-backed symbol outline and exact resolver.</td>
                <td>
                  <code>path</code>, <code>file</code>,
                  <code>start_line</code>, <code>end_line</code>,
                  <code>limitSymbols</code>, <code>resolveMode</code>,
                  <code>symbolIdExact</code>, <code>symbolLabelExact</code>
                </td>
                <td>
                  Exact mode returns deterministic statuses:
                  <code>ok|ambiguous|not_found</code>; includes
                  <code>hasMore</code>.
                </td>
              </tr>
              <tr>
                <td><code>call_graph</code></td>
                <td>Traverse callers/callees from a symbolRef.</td>
                <td>
                  <code>path</code>, <code>symbolRef</code>,
                  <code>direction</code>, <code>depth</code>,
                  <code>limit</code>
                </td>
                <td>
                  Uses prebuilt sidecar; deterministic node/edge ordering.
                  Alias <code>bidirectional</code> is normalized to
                  <code>both</code>.
                </td>
              </tr>
              <tr>
                <td><code>read_file</code></td>
                <td>Safe file reads with optional line ranges and annotated mode.</td>
                <td>
                  <code>path</code>, <code>start_line</code>,
                  <code>end_line</code>, <code>mode</code>,
                  <code>open_symbol</code>
                </td>
                <td>
                  <code>mode=annotated</code> returns content +
                  <code>outlineStatus</code>. Large reads are truncated by
                  <code>READ_FILE_MAX_LINES</code>.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="section">
        <h2>State and Safety</h2>
        <p class="intro">
          Snapshot state controls searchable access. Fingerprint mismatches are
          hard-gated into deterministic <code>requires_reindex</code> outcomes
          until explicit recovery.
        </p>
        <div class="diagram-wrap">
          <div class="mermaid">
stateDiagram-v2
    [*] --> not_indexed

    not_indexed --> indexing: manage_index(create)
    indexing --> ready: success
    indexing --> failed: failure

    ready --> sync_completed: manage_index(sync) / auto-sync
    sync_completed --> sync_completed: subsequent sync

    ready --> requires_reindex: fingerprint mismatch gate
    sync_completed --> requires_reindex: fingerprint mismatch gate
    requires_reindex --> indexing: manage_index(reindex)

    ready --> not_indexed: clear
    sync_completed --> not_indexed: clear
    failed --> not_indexed: clear
    requires_reindex --> not_indexed: clear
          </div>
        </div>
        <div class="grid-2">
          <article class="card">
            <h3>Fingerprint Fields</h3>
            <p>
              <code
                >{ embeddingProvider, embeddingModel, embeddingDimension,
                vectorStoreProvider, schemaVersion
                }</code
              >
            </p>
          </article>
          <article class="card">
            <h3>Safety Result</h3>
            <p>
              Prevents silent reads from incompatible embedding
              models/dimensions or schema-mode mismatches.
            </p>
          </article>
        </div>
      </section>

      <section class="section">
        <h2>Search And Sync Behavior</h2>
        <div class="details-list">
          <details>
            <summary>Search Pipeline</summary>
            <div class="details-body">
              <pre><code>freshness gate (search_codebase sync-on-read, ~3m staleness window)
  -> operator parse (lang:, path:, -path:, must:, exclude:)
       path operators use gitignore-style matching over normalized relative paths
  -> bounded candidate retrieval (SEARCH_MAX_CANDIDATES)
  -> deterministic filter precedence:
       scope -> lang -> path include -> path exclude -> must -> exclude
  -> rerank policy (docs scope skipped by default; graceful degradation on failure)
  -> changed-files boost (git status cache TTL ~5s, max changed-files threshold 50)
  -> grouping + diversity caps (deterministic relaxed pass)
  -> tie-break chain:
       score desc -> file asc -> start_line asc -> symbol label asc -> symbol id asc
  -> noise hint emission when visible top-K crosses noise threshold</code></pre>
            </div>
          </details>

          <details>
            <summary>Ignore Model</summary>
            <div class="details-body">
              <pre><code>ignore sources:
  .gitignore + .satoriignore + configured ignore patterns

reconcile flow:
  control-file signature change detected
    -> delete newly ignored indexed paths
    -> reload synchronizer
    -> forced incremental sync
    -> update signature/version
    -> coalesce concurrent reconcile requests</code></pre>
              <p class="intro">
                Non-watcher convergence is still guaranteed via signature checks
                during <code>ensureFreshness</code>.
              </p>
            </div>
          </details>

          <details>
            <summary>Capability Resolver + Rerank</summary>
            <div class="details-body">
              <pre><code>capability profile (fast / standard / slow)
  -> default and max search limits
  -> rerank policy decision
  -> docs scope skips rerank by policy in current public surface
  -> no public useReranker override knob</code></pre>
              <p class="intro">
                If rerank is attempted and fails, responses degrade with
                <code>RERANKER_FAILED</code> warnings and deterministic ordering
                is preserved.
              </p>
            </div>
          </details>

          <details>
            <summary>Incremental Sync</summary>
            <div class="details-body">
              <pre><code>stat-first scan (size + mtime signature)
  -> reuse prior hash when unchanged
  -> hash bytes only for changed/new candidates
  -> deterministic merkleRoot from sorted (relativePath, hash)
  -> diff {added, removed, modified}
  -> apply vector updates incrementally</code></pre>
              <p class="intro">
                Partial scans preserve prior entries for unreadable files/dirs
                to avoid false removals; true removals under unreadable prefixes
                are delayed until readability returns.
              </p>
            </div>
          </details>
        </div>
      </section>

      <section class="section">
        <h2>Transcript-Style Agent Calls</h2>
        <p class="intro">
          Representative MCP calls and output shape from real usage patterns.
        </p>
        <div style="margin: 2rem 0 1rem 0">
          <button class="btn copy-btn" data-copy="trace-block">
            Copy Trace
          </button>
        </div>
        <pre
          style="margin-top: 0"
        ><code id="trace-block">Called satori.list_codebases({})
Called satori.manage_index({"action":"status","path":"/home/hamza/repo/tradingview_ratio"})
-> sync completed | +0 added, -0 removed, ~0 modified

Called satori.search_codebase({"path":"/home/hamza/repo/tradingview_ratio","query":"auth refresh token flow","scope":"runtime","resultMode":"grouped","groupBy":"symbol","limit":5})
-> Hit: src/auth/session.ts:88-141
-> callGraphHint.symbolRef: {"file":"src/auth/session.ts","symbolId":"sym_auth_refresh"}

Called satori.call_graph({"path":"/home/hamza/repo/tradingview_ratio","symbolRef":{"file":"src/auth/session.ts","symbolId":"sym_auth_refresh"},"direction":"both","depth":2,"limit":20})
-> nodes: 6, edges: 8, notes: 1

Called satori.file_outline({"path":"/home/hamza/repo/tradingview_ratio","file":"src/auth/session.ts","limitSymbols":50})
-> 12 symbols resolved | spans locked

Called satori.read_file({"path":"src/auth/session.ts","open_symbol":"refreshToken","mode":"annotated"})
-> lines 88-141 | outlineStatus: ok | no warnings

File not found recovery:
Called satori.search_codebase({"path":"/home/hamza/repo/tradingview_ratio","query":"INVARIANTS.md canonical path","scope":"docs","resultMode":"raw","limit":10})
Called satori.read_file({"path":"/home/hamza/repo/tradingview_ratio/docs/INVARIANTS.md","start_line":480,"end_line":620,"mode":"annotated"})</code></pre>
      </section>

      <footer class="footer">
        <span
          >Landing: <a href="index.html">index.html</a> · Source:
          <a href="https://github.com/ham-zax/satori" target="_blank"
            >github.com/ham-zax/satori</a
          >
          · Docs:
          <a
            href="https://github.com/ham-zax/satori/blob/main/README.md"
            target="_blank"
            >README.md</a
          ></span
        >
        <span
          >This page describes behavior. If it’s here, there should be a test
          for it. · <a href="index.html">Back to Landing</a></span
        >
      </footer>
    </div>

    <script>
      const isSmallViewport = window.matchMedia("(max-width: 920px)").matches;
      if (!isSmallViewport) {
        const mermaidScript = document.createElement("script");
        mermaidScript.src =
          "https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js";
        mermaidScript.onload = () => {
          if (!window.mermaid) return;
          window.mermaid.initialize({
            startOnLoad: true,
            securityLevel: "loose",
            theme: "dark",
            themeVariables: {
              background: "#0a0a0b",
              primaryColor: "#111114",
              primaryTextColor: "#f6f6f6",
              primaryBorderColor: "rgba(246, 246, 246, 0.28)",
              lineColor: "rgba(246, 246, 246, 0.55)",
              secondaryColor: "#111114",
              tertiaryColor: "#111114",
            },
          });
        };
        document.body.appendChild(mermaidScript);
      } else {
        const diagramWraps = document.querySelectorAll(".diagram-wrap");
        diagramWraps.forEach((wrap) => {
          wrap.innerHTML =
            '<p class="intro">Diagram rendering is disabled on small screens to prioritize load speed. Open on desktop for full rendered diagrams.</p>';
        });
      }

      const copyButtons = document.querySelectorAll(".copy-btn");
      copyButtons.forEach((btn) => {
        btn.addEventListener("click", async () => {
          const id = btn.getAttribute("data-copy");
          const source = document.getElementById(id);
          if (!source) return;
          const previous = btn.textContent;
          try {
            await navigator.clipboard.writeText(source.textContent);
            btn.textContent = "Copied";
          } catch {
            btn.textContent = "Copy failed";
          }
          setTimeout(() => {
            btn.textContent = previous;
          }, 1100);
        });
      });
    </script>
  </body>
</html>
