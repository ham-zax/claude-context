<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Satori | Architecture</title>
    <meta
      name="description"
      content="How Satori works under the hood — from file change to agent result: packages/core trust layer, packages/mcp runtime, vector store, call-graph sidecar, and deterministic six-tool MCP surface."
    />
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
      media="(min-width: 921px)"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
      media="(min-width: 921px)"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@100;400;700&display=swap"
      rel="stylesheet"
      media="(min-width: 921px)"
    />
    <style>
      :root {
        --bg: #000000;
        --panel: rgba(10, 10, 10, 0.85);
        --fg: #ffffff;
        --muted: rgba(255, 255, 255, 0.55);
        --line: rgba(255, 255, 255, 0.15);
        --accent: #dfff00; /* Radioactive Chartreuse */
        --accent-dim: rgba(223, 255, 0, 0.15);
        --serif: "Cormorant Garamond", serif;
        --sans: "Inter", sans-serif;
        --mono: "JetBrains Mono", monospace;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        cursor: crosshair;
      }

      body {
        min-height: 100vh;
        color: var(--fg);
        font-family: var(--sans);
        background-color: #030303;
        background-image: radial-gradient(circle at 50% 0%, rgba(20, 20, 25, 1) 0%, #030303 100%);
        line-height: 1.6;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
      }

    /* Premium Tech Grid SVG Accents */
    .bg-accents {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -2; pointer-events: none;
    }
    
    .cursed-energy {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
      pointer-events: none;
      overflow: hidden;
      opacity: 0.3;
      background: 
        radial-gradient(circle at 20% 30%, rgba(138, 43, 226, 0.08) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(0, 170, 255, 0.05) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(255, 0, 85, 0.08) 0%, transparent 50%);
      filter: blur(40px);
      animation: cursed-pulse 10s ease-in-out infinite alternate;
    }
    
    .cursed-wisp {
      position: absolute;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      background: 
        conic-gradient(from 0deg at 50% 50%, transparent 0deg, rgba(138, 43, 226, 0.05) 90deg, transparent 180deg, rgba(0, 170, 255, 0.03) 270deg, transparent 360deg);
      animation: cursed-rotate 20s linear infinite;
      mix-blend-mode: screen;
    }
    
    .cursed-wisp:nth-child(2) {
      animation-direction: reverse;
      animation-duration: 25s;
      opacity: 0.5;
      background: 
        conic-gradient(from 180deg at 50% 50%, transparent 0deg, rgba(255, 0, 85, 0.05) 90deg, transparent 180deg, rgba(138, 43, 226, 0.05) 270deg, transparent 360deg);
    }
    
    @keyframes cursed-pulse { 0% { transform: scale(1); opacity: 0.3; } 50% { transform: scale(1.1); opacity: 0.5; } 100% { transform: scale(1); opacity: 0.3; } }
    @keyframes cursed-rotate { 0% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(180deg) scale(1.2); } 100% { transform: rotate(360deg) scale(1); } }


      ::selection {
        background: var(--accent);
        color: #060607;
      }

      .container {
        max-width: 1140px;
        margin: 0 auto;
        padding: 1rem 1rem 4rem;
      }

      .container > section:nth-of-type(1) {
        --section-accent: #dfff00;
        --section-accent-dim: rgba(223, 255, 0, 0.16);
      }

      .container > section:nth-of-type(2) {
        --section-accent: #00e5ff;
        --section-accent-dim: rgba(0, 229, 255, 0.16);
      }

      .container > section:nth-of-type(3) {
        --section-accent: #00aaff;
        --section-accent-dim: rgba(0, 170, 255, 0.16);
      }

      .container > section:nth-of-type(4) {
        --section-accent: #ffb020;
        --section-accent-dim: rgba(255, 176, 32, 0.16);
      }

      .container > section:nth-of-type(5) {
        --section-accent: #8a2be2;
        --section-accent-dim: rgba(138, 43, 226, 0.16);
      }

      .container > section:nth-of-type(6) {
        --section-accent: #00ff99;
        --section-accent-dim: rgba(0, 255, 153, 0.16);
      }

      .container > section:nth-of-type(7) {
        --section-accent: #ff4d7a;
        --section-accent-dim: rgba(255, 77, 122, 0.16);
      }

      nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 1.2rem 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-size: 0.75rem;
        font-family: var(--mono);
        background: rgba(10, 10, 10, 0.6);
        backdrop-filter: blur(16px);
        position: sticky;
        top: 1rem;
        z-index: 100;
        box-shadow: 0 4px 24px -2px rgba(0, 0, 0, 0.5);
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        background: var(--accent);
        border-radius: 50%;
        box-shadow: 0 0 10px var(--accent);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(0.9);
        }
      }

      .nav-links {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
      }

      a {
        color: var(--fg);
        text-decoration: none;
        transition: color 0.2s;
      }

      a:hover {
        color: var(--accent);
      }

      .hero {
        margin-top: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-left: 2px solid var(--section-accent, var(--accent));
        padding: 5rem 2rem;
        background: linear-gradient(
          145deg,
          rgba(22, 22, 26, 0.58) 0%,
          rgba(8, 8, 10, 0.76) 100%
        );
        backdrop-filter: blur(12px);
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        box-shadow: 0 12px 36px rgba(0, 0, 0, 0.42);
        transition: all 0.25s ease;
      }

      .hero:hover {
        border-color: var(--section-accent-dim, var(--accent-dim));
        box-shadow: 0 12px 40px var(--section-accent-dim, var(--accent-dim));
      }

      h1 {
        font-family: var(--serif);
        font-size: clamp(3rem, 8vw, 6rem);
        line-height: 0.9;
        font-weight: 300;
        letter-spacing: -0.04em;
        transition:
          color 0.2s,
          text-shadow 0.2s;
      }

      h1:hover {
        color: var(--accent);
        text-shadow: 0 0 60px var(--accent-dim);
      }

      .hero p {
        margin-top: 1.5rem;
        max-width: 800px;
        color: var(--muted);
        font-size: 1.1rem;
        font-weight: 300;
      }

      .hero p .sel {
        display: inline-block;
        padding: 0.02rem 0.24rem;
        margin: 0 0.06rem;
        border-radius: 0.14rem;
        line-height: 1.35;
      }

      .hero p .sel-core {
        background: rgba(105, 216, 255, 0.22);
        color: #bdefff;
      }

      .hero p .sel-mcp {
        background: rgba(223, 255, 0, 0.22);
        color: #eaff9b;
      }

      .hero p .sel-safety {
        background: rgba(255, 140, 107, 0.22);
        color: #ffc5b5;
      }

      .hero p .sel-data {
        background: rgba(180, 142, 255, 0.24);
        color: #d8beff;
      }

      .hero-meta {
        margin-top: 2rem;
        font-family: var(--mono);
        font-size: 0.75rem;
        color: var(--section-accent, var(--accent));
        text-transform: uppercase;
        letter-spacing: 0.15em;
      }

      .section {
        margin-top: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-left: 3px solid var(--section-accent, var(--accent));
        background: linear-gradient(
          145deg,
          rgba(18, 18, 20, 0.56) 0%,
          rgba(8, 8, 10, 0.74) 100%
        );
        backdrop-filter: blur(12px);
        padding: 4rem 2rem;
        position: relative;
        box-shadow: 0 12px 34px rgba(0, 0, 0, 0.38);
        transition: all 0.25s ease;
      }

      .section:hover {
        border-color: var(--section-accent-dim, var(--accent-dim));
        box-shadow: 0 12px 40px var(--section-accent-dim, var(--accent-dim));
      }

      h2 {
        font-family: var(--serif);
        font-size: clamp(2rem, 5vw, 3.5rem);
        line-height: 0.95;
        font-weight: 300;
        margin-bottom: 1rem;
      }

      .intro {
        font-family: var(--sans);
        font-size: 1.1rem;
        font-weight: 300;
        color: var(--muted);
        max-width: 800px;
        margin-bottom: 2.5rem;
      }

      .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 1rem;
      }

      .card {
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.03);
        padding: 2rem;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(8px);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08);
      }

      .card:hover {
        border-color: var(--section-accent-dim, var(--accent-dim));
        background: rgba(255, 255, 255, 0.05);
        transform: translateY(-2px);
      }

      .card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 1px;
        background: var(--section-accent, var(--accent));
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
      }

      .card:hover::before {
        transform: scaleX(1);
      }

      .card h3 {
        font-family: var(--mono);
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: var(--section-accent, var(--accent));
        margin-bottom: 1rem;
      }

      .card p,
      .card li {
        font-family: var(--sans);
        color: var(--muted);
        font-size: 0.95rem;
        font-weight: 300;
        line-height: 1.6;
      }

      .card ul {
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .card li {
        padding-left: 1rem;
        position: relative;
      }

      .card li::before {
        content: ">>";
        position: absolute;
        left: 0;
        color: var(--section-accent, var(--accent));
        opacity: 0.5;
        font-family: var(--mono);
        font-size: 0.8rem;
      }

      .runtime-card {
        border-color: rgba(255, 255, 255, 0.2);
      }

      .runtime-card h3 {
        color: var(--runtime-accent);
      }

      .runtime-card li::before {
        color: var(--runtime-accent);
        opacity: 0.9;
      }

      .runtime-card li {
        padding-left: 1.7rem;
      }

      .runtime-card code {
        color: var(--runtime-accent);
        background: var(--runtime-bg);
      }

      .runtime-mcp {
        --runtime-accent: #dfff00;
        --runtime-bg: rgba(223, 255, 0, 0.08);
        --runtime-line: rgba(223, 255, 0, 0.35);
      }

      .runtime-core {
        --runtime-accent: #69d8ff;
        --runtime-bg: rgba(105, 216, 255, 0.1);
        --runtime-line: rgba(105, 216, 255, 0.35);
      }

      .table-wrap {
        margin-top: 2rem;
        overflow-x: auto;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(10px);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 760px;
      }

      th,
      td {
        border-bottom: 1px solid var(--line);
        padding: 1rem 1.5rem;
        text-align: left;
        vertical-align: top;
        font-size: 0.9rem;
        font-family: var(--sans);
        font-weight: 300;
      }

      th {
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-size: 0.75rem;
        color: var(--section-accent, var(--accent));
        background: rgba(0, 0, 0, 0.4);
        font-family: var(--mono);
      }

      td code {
        color: var(--section-accent, var(--accent));
        background: rgba(255, 255, 255, 0.08);
        padding: 0.2rem 0.4rem;
        font-size: 0.8rem;
      }

      pre {
        margin: 1rem 0 0 0;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(5, 5, 8, 0.74);
        padding: 1rem;
        overflow-x: auto;
        font-size: 0.8rem;
        line-height: 1.6;
        white-space: pre;
        color: var(--muted);
        box-shadow: inset 0 2px 14px rgba(0, 0, 0, 0.5);
      }

      pre::-webkit-scrollbar,
      .diagram-wrap::-webkit-scrollbar,
      .table-wrap::-webkit-scrollbar {
        height: 4px;
      }

      pre::-webkit-scrollbar-thumb,
      .diagram-wrap::-webkit-scrollbar-thumb,
      .table-wrap::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
      }

      .diagram-wrap {
        margin-top: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(8, 8, 10, 0.6);
        backdrop-filter: blur(10px);
        padding: 2rem;
        overflow-x: auto;
        display: flex;
        justify-content: center;
      }

      .arch-diagram-wrapper {
        width: 100%;
        min-width: 0;
      }

      .arch-svg {
        width: 100%;
        height: auto;
        display: block;
      }

      code {
        font-family: var(--mono);
      }

      .details-list {
        margin-top: 2rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      details {
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(8px);
        transition: border-color 0.2s;
      }

      details:hover {
        border-color: var(--section-accent-dim, var(--accent-dim));
      }

      summary {
        cursor: pointer;
        list-style: none;
        padding: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        font-size: 0.85rem;
        font-family: var(--mono);
        color: var(--section-accent, var(--accent));
      }

      summary::-webkit-details-marker {
        display: none;
      }

      .details-body {
        border-top: 1px dotted var(--line);
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .details-body pre {
        margin-top: 0;
      }

      .btn {
        border: 1px solid var(--fg);
        background: transparent;
        color: var(--fg);
        font-family: var(--mono);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        padding: 0.6rem 1rem;
        cursor: pointer;
        width: fit-content;
        transition: all 0.2s ease;
        white-space: nowrap;
      }

      .btn:hover {
        background: var(--accent);
        color: var(--bg);
        border-color: var(--accent);
        box-shadow: 0 0 20px var(--accent-dim);
        font-weight: 700;
      }

      .footer {
        margin-top: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-left: 3px solid #dfff00;
        background: rgba(10, 10, 12, 0.65);
        backdrop-filter: blur(10px);
        padding: 1.5rem 2rem;
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        flex-wrap: wrap;
        color: var(--muted);
        font-size: 0.85rem;
        font-family: var(--sans);
        font-weight: 300;
      }

      @media (max-width: 920px) {
        :root {
          --serif: ui-serif, Georgia, serif;
          --sans:
            system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",
            Arial, sans-serif;
          --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        }

        * {
          cursor: auto;
        }

        body {
          background-image: none;
        }

        nav {
          backdrop-filter: none;
        }

        .status-dot {
          animation: none;
          box-shadow: none;
        }

        .hero,
        .card,
        .btn,
        .section,
        details,
        a {
          transition: none !important;
        }

        .hero:hover,
        .card:hover,
        .btn:hover {
          box-shadow: none;
          transform: none;
        }

        .section:hover {
          border-left: 3px solid var(--section-accent, var(--accent));
        }

        details:hover {
          border-color: var(--line);
        }

        .grid-2 {
          grid-template-columns: 1fr;
        }

        .hero {
          padding: 4rem 1.5rem;
        }

        .section {
          padding: 3rem 1.5rem;
        }

        .card {
          padding: 1.5rem;
        }
      }
    </style>
  </head>
  <body>
  <svg class="bg-accents" viewBox="0 0 100 100" preserveAspectRatio="none">
    <defs>
      <pattern id="grid" width="8" height="8" patternUnits="userSpaceOnUse">
        <path d="M 8 0 L 0 0 0 8" fill="none" stroke="rgba(255, 255, 255, 0.03)" stroke-width="0.1"/>
      </pattern>
      <linearGradient id="fade" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="rgba(0,0,0,0)" />
        <stop offset="50%" stop-color="rgba(0,0,0,0.8)" />
        <stop offset="100%" stop-color="rgba(0,0,0,1)" />
      </linearGradient>
    </defs>
    <rect width="100" height="100" fill="url(#grid)" />
    <rect width="100" height="100" fill="url(#fade)" />
  </svg>
  <div class="cursed-energy">
    <div class="cursed-wisp"></div>
    <div class="cursed-wisp"></div>
  </div>

    <div class="container">
      <nav>
        <div class="nav-brand">
          <div class="status-dot"></div>
          <span>Satori // Architecture // Six Tools • One Workflow</span>
        </div>
        <div class="nav-links">
          <a href="index.html">[ Landing ]</a>
          <a href="https://github.com/ham-zax/satori" target="_blank"
            >[ Repository ]</a
          >
        </div>
      </nav>

      <section class="hero">
        <h1>Satori Architecture</h1>
        <p>
          Two packages work in concert:
          <span class="sel sel-core"><code>packages/core</code></span> is the
          <span class="sel sel-core">trust layer</span>
          (<span class="sel sel-safety">merkle/hash-on-change sync</span>,
          <span class="sel sel-safety">partial-scan safety</span>,
          <span class="sel sel-safety">path-normalization SSOT</span>).
          <span class="sel sel-mcp"><code>packages/mcp</code></span> is the
          agent interface
          (<span class="sel sel-mcp">six-tool contract</span>,
          <span class="sel sel-mcp">freshness gating</span>,
          <span class="sel sel-mcp">search orchestration</span>,
          <span class="sel sel-mcp">sidecar lifecycle</span>,
          <span class="sel sel-safety">snapshot/fingerprint gates</span>).
          <span class="sel sel-data">Zilliz Cloud (Milvus)</span> and a
          <span class="sel sel-data">call-graph sidecar</span> provide the
          <span class="sel sel-data">retrieval substrate</span>.
        </p>
        <div class="hero-meta">
          Six MCP tools • Sync-on-read for search • Fingerprint gates • Merkle
          incremental sync • Call-graph sidecar
        </div>
        <div class="hero-meta">
          Six tools = six eyes into your repo: search → outline → graph → read.
        </div>
      </section>

      <section class="section">
        <h2>System Overview</h2>
        <p class="intro">
          Agent requests route through a fixed six-tool registry. The MCP
          runtime enforces freshness/fingerprint gates and orchestrates search.
          Core sync provides deterministic file-state truth for indexing.
        </p>
        <div class="diagram-wrap">
          
          <div class="arch-diagram-wrapper">
            <svg class="arch-svg" viewBox="0 0 800 500" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="grad-agent" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(223, 255, 0, 0.2)" />
                  <stop offset="100%" stop-color="rgba(223, 255, 0, 0.05)" />
                </linearGradient>
                <linearGradient id="grad-mcp" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(0, 170, 255, 0.2)" />
                  <stop offset="100%" stop-color="rgba(0, 170, 255, 0.05)" />
                </linearGradient>
                <linearGradient id="grad-store" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(138, 43, 226, 0.2)" />
                  <stop offset="100%" stop-color="rgba(138, 43, 226, 0.05)" />
                </linearGradient>
                
                <marker id="overview-arrowhead" viewBox="0 0 10 10" markerUnits="userSpaceOnUse" markerWidth="7" markerHeight="7" refX="9" refY="5" orient="auto-start-reverse">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(255, 255, 255, 0.45)" />
                </marker>
                
                <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                  <feGaussianBlur stdDeviation="8" result="blur" />
                  <feMerge>
                    <feMergeNode in="blur" />
                    <feMergeNode in="SourceGraphic" />
                  </feMerge>
                </filter>
              </defs>

              <!-- Edges -->
              <path d="M 400 80 L 400 130" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#overview-arrowhead)" />
              <path d="M 400 200 L 400 250" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#overview-arrowhead)" />
              
              <path d="M 400 370 L 400 420" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#overview-arrowhead)" />
              <path d="M 300 370 L 200 420" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#overview-arrowhead)" />
              <path d="M 500 370 L 600 420" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#overview-arrowhead)" />

              <!-- Nodes -->
              <!-- Agent -->
              <g transform="translate(300, 10)">
                <rect width="200" height="70" rx="8" fill="url(#grad-agent)" stroke="rgba(223, 255, 0, 0.5)" stroke-width="2" />
                <text x="100" y="30" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">Agent</text>
                <text x="100" y="50" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12" text-anchor="middle">Claude / Codex / Cursor</text>
              </g>

              <!-- Tool Registry -->
              <g transform="translate(300, 130)">
                <rect width="200" height="70" rx="8" fill="rgba(255, 255, 255, 0.05)" stroke="rgba(255, 255, 255, 0.2)" stroke-width="1" stroke-dasharray="4 4" />
                <text x="100" y="30" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">Tool Registry</text>
                <text x="100" y="50" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12" text-anchor="middle">(6 MCP Tools)</text>
              </g>

              <!-- MCP Runtime -->
              <g transform="translate(250, 250)">
                <rect width="300" height="120" rx="8" fill="url(#grad-mcp)" stroke="rgba(0, 170, 255, 0.5)" stroke-width="2" filter="url(#glow)" />
                <text x="150" y="35" fill="#fff" font-family="sans-serif" font-size="18" font-weight="bold" text-anchor="middle">MCP Runtime</text>
                <text x="150" y="60" fill="rgba(255,255,255,0.8)" font-family="sans-serif" font-size="12" text-anchor="middle">ToolHandlers &amp; Orchestration</text>
                <text x="150" y="80" fill="rgba(255,255,255,0.8)" font-family="sans-serif" font-size="12" text-anchor="middle">Freshness Gate</text>
                <text x="150" y="100" fill="rgba(255,255,255,0.8)" font-family="sans-serif" font-size="12" text-anchor="middle">Snapshot + Fingerprint Gates</text>
              </g>

              <!-- Vector Store -->
              <g transform="translate(100, 420)">
                <rect width="180" height="70" rx="8" fill="url(#grad-store)" stroke="rgba(138, 43, 226, 0.5)" stroke-width="2" />
                <text x="90" y="30" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">Vector Store</text>
                <text x="90" y="50" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12" text-anchor="middle">Zilliz / Milvus</text>
              </g>

              <!-- Sidecar -->
              <g transform="translate(310, 420)">
                <rect width="180" height="70" rx="8" fill="url(#grad-store)" stroke="rgba(138, 43, 226, 0.5)" stroke-width="2" />
                <text x="90" y="30" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">Call-Graph Sidecar</text>
                <text x="90" y="50" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12" text-anchor="middle">AST graph artifacts</text>
              </g>

              <!-- Core -->
              <g transform="translate(520, 420)">
                <rect width="180" height="70" rx="8" fill="url(#grad-store)" stroke="rgba(138, 43, 226, 0.5)" stroke-width="2" />
                <text x="90" y="30" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">Core Sync</text>
                <text x="90" y="50" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12" text-anchor="middle">File Sync / Merkle / Hash</text>
              </g>
            </svg>
          </div>

        </div>
      </section>

      <section class="section">
        <h2>Runtime Boundaries</h2>
        <div class="grid-2">
          <article class="card runtime-card runtime-mcp">
            <h3>MCP Runtime (@zokizuan/satori-mcp)</h3>
            <ul>
              <li>Owns the six-tool MCP contract and schema validation.</li>
              <li>
                Runs freshness gating: sync-on-read is executed for
                <code>search_codebase</code>.
              </li>
              <li>
                Applies snapshot/fingerprint compatibility gates with
                deterministic <code>requires_reindex</code> envelopes.
              </li>
              <li>
                Schedules background periodic sync and optional debounced
                watcher sync.
              </li>
              <li>
                Reconciles <code>.satoriignore</code>/<code>.gitignore</code>
                edits without full reindex.
              </li>
              <li>
                Reconciles cloud snapshot metadata before handler execution to
                keep local state aligned.
              </li>
              <li>
                Manages sidecar lifecycle and fallback behavior when graph data
                is unavailable.
              </li>
            </ul>
          </article>
          <article class="card runtime-card runtime-core">
            <h3>Core Engine (@zokizuan/satori-core)</h3>
            <ul>
              <li>
                Maintains the sync trust layer: stat-first, hash-on-change,
                deterministic merkle root.
              </li>
              <li>
                Preserves prior entries under partial scans (unreadable files
                and directories).
              </li>
              <li>
                Enforces path normalization SSOT for scan/snapshot/diff flows.
              </li>
              <li>
                Re-embeds only changed files for incremental indexing
                performance.
              </li>
              <li>
                Performs AST-aware chunking/splitting and remains MCP-agnostic.
              </li>
            </ul>
          </article>
        </div>
      </section>

      <section class="section">
        <h2>Tool Surface</h2>
        <p class="intro">
          Satori intentionally exposes only six MCP tools to reduce routing
          ambiguity while keeping call-chain traversal and file navigation
          first-class.
        </p>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tool</th>
                <th>Purpose</th>
                <th>Key Params</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>list_codebases</code></td>
                <td>Inventory tracked roots and indexing state.</td>
                <td>None</td>
                <td>
                  Deterministic bucket order with lexicographically sorted paths
                  per bucket.
                </td>
              </tr>
              <tr>
                <td><code>manage_index</code></td>
                <td>Index lifecycle and recovery operations.</td>
                <td>
                  <code>action</code>, <code>path</code>, optional
                  <code>force</code>, <code>customExtensions</code>,
                  <code>ignorePatterns</code>, <code>zillizDropCollection</code>
                </td>
                <td>
                  Actions: <code>create|reindex|sync|status|clear</code>. No
                  public splitter knob.
                </td>
              </tr>
              <tr>
                <td><code>search_codebase</code></td>
                <td>
                  Runtime-first semantic search with grouped/raw output.
                </td>
                <td>
                  <code>query</code>, <code>scope</code>,
                  <code>resultMode</code>, <code>groupBy</code>,
                  <code>rankingMode</code>, <code>limit</code>, optional
                  <code>debug</code>
                </td>
                <td>
                  Defaults:
                  <code>scope=runtime,resultMode=grouped,groupBy=symbol,rankingMode=auto_changed_first</code>.
                  Includes <code>freshnessDecision</code> and grouped
                  <code>callGraphHint</code>.
                </td>
              </tr>
              <tr>
                <td><code>file_outline</code></td>
                <td>Sidecar-backed symbol outline and exact resolver.</td>
                <td>
                  <code>path</code>, <code>file</code>,
                  <code>start_line</code>, <code>end_line</code>,
                  <code>limitSymbols</code>, <code>resolveMode</code>,
                  <code>symbolIdExact</code>, <code>symbolLabelExact</code>
                </td>
                <td>
                  Exact mode returns deterministic statuses:
                  <code>ok|ambiguous|not_found</code>; includes
                  <code>hasMore</code>.
                </td>
              </tr>
              <tr>
                <td><code>call_graph</code></td>
                <td>Traverse callers/callees from a symbolRef.</td>
                <td>
                  <code>path</code>, <code>symbolRef</code>,
                  <code>direction</code>, <code>depth</code>,
                  <code>limit</code>
                </td>
                <td>
                  Uses prebuilt sidecar; deterministic node/edge ordering.
                  Alias <code>bidirectional</code> is normalized to
                  <code>both</code>.
                </td>
              </tr>
              <tr>
                <td><code>read_file</code></td>
                <td>Safe file reads with optional line ranges and annotated mode.</td>
                <td>
                  <code>path</code>, <code>start_line</code>,
                  <code>end_line</code>, <code>mode</code>,
                  <code>open_symbol</code>
                </td>
                <td>
                  <code>mode=annotated</code> returns content +
                  <code>outlineStatus</code>. Large reads are truncated by
                  <code>READ_FILE_MAX_LINES</code>.
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="section">
        <h2>State and Safety</h2>
        <p class="intro">
          Snapshot state controls searchable access. Fingerprint mismatches are
          hard-gated into deterministic <code>requires_reindex</code> outcomes
          until explicit recovery.
        </p>
        <div class="diagram-wrap">
          
          <div class="arch-diagram-wrapper">
            <svg class="arch-svg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="grad-idle" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(255, 255, 255, 0.1)" />
                  <stop offset="100%" stop-color="rgba(255, 255, 255, 0.02)" />
                </linearGradient>
                <linearGradient id="grad-active" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(0, 170, 255, 0.2)" />
                  <stop offset="100%" stop-color="rgba(0, 170, 255, 0.05)" />
                </linearGradient>
                <linearGradient id="grad-success" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(0, 255, 136, 0.2)" />
                  <stop offset="100%" stop-color="rgba(0, 255, 136, 0.05)" />
                </linearGradient>
                <linearGradient id="grad-error" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(255, 0, 85, 0.2)" />
                  <stop offset="100%" stop-color="rgba(255, 0, 85, 0.05)" />
                </linearGradient>
                <linearGradient id="grad-warn" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="rgba(255, 170, 0, 0.2)" />
                  <stop offset="100%" stop-color="rgba(255, 170, 0, 0.05)" />
                </linearGradient>
                
                <marker id="state-arrowhead" viewBox="0 0 10 10" markerUnits="userSpaceOnUse" markerWidth="7" markerHeight="7" refX="9" refY="5" orient="auto-start-reverse">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(255, 255, 255, 0.45)" />
                </marker>
                <marker id="state-arrowhead-red" viewBox="0 0 10 10" markerUnits="userSpaceOnUse" markerWidth="7" markerHeight="7" refX="9" refY="5" orient="auto-start-reverse">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(255, 0, 85, 0.45)" />
                </marker>
              </defs>

              <!-- Link: not_indexed -> indexing -->
              <path d="M 400 90 L 400 160" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" />
              <text x="410" y="130" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12">manage_index(create)</text>

              <!-- Link: indexing -> ready -->
              <path d="M 360 230 L 250 300" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" />
              <text x="290" y="255" fill="rgba(0, 255, 136, 0.8)" font-family="sans-serif" font-size="12" text-anchor="end">success</text>

              <!-- Link: indexing -> failed -->
              <path d="M 440 230 L 550 300" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" />
              <text x="510" y="255" fill="rgba(255, 0, 85, 0.8)" font-family="sans-serif" font-size="12" text-anchor="start">failure</text>

              <!-- Link: ready -> sync_completed -->
              <path d="M 200 370 L 200 450" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" />
              <text x="210" y="415" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12">manage_index(sync)</text>

              <!-- Link: sync loop -->
              <path d="M 180 520 C 130 560, 50 500, 100 480" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" />
              <text x="110" y="550" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12" text-anchor="middle">auto-sync</text>

              <!-- Link: ready -> requires_reindex -->
              <path d="M 300 335 L 500 450" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" stroke-dasharray="4 4" />
              <text x="400" y="380" fill="rgba(255, 170, 0, 0.8)" font-family="sans-serif" font-size="12" text-anchor="middle">fingerprint mismatch</text>
              
              <!-- Link: sync_completed -> requires_reindex -->
              <path d="M 300 485 L 500 485" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" stroke-dasharray="4 4" />
              
              <!-- Link: requires_reindex -> indexing -->
              <path d="M 600 450 C 760 360, 760 180, 500 195" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" fill="none" marker-end="url(#state-arrowhead)" />
              <text x="744" y="286" fill="rgba(255,255,255,0.6)" font-family="sans-serif" font-size="12" text-anchor="end">manage_index(reindex)</text>

              <!-- Link: clear -->
              <path d="M 700 485 L 750 485 L 750 55 L 500 55" stroke="rgba(255, 0, 85, 0.3)" stroke-width="1.5" fill="none" marker-end="url(#state-arrowhead-red)" stroke-dasharray="2 2" />
              <text x="740" y="45" fill="rgba(255, 0, 85, 0.8)" font-family="sans-serif" font-size="12" text-anchor="end">manage_index(clear) from any state</text>


              <!-- Node: not_indexed -->
              <g transform="translate(300, 20)">
                <rect width="200" height="70" rx="35" fill="url(#grad-idle)" stroke="rgba(255, 255, 255, 0.3)" stroke-width="2" />
                <text x="100" y="40" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">not_indexed</text>
              </g>

              <!-- Node: indexing -->
              <g transform="translate(300, 160)">
                <rect width="200" height="70" rx="35" fill="url(#grad-active)" stroke="rgba(0, 170, 255, 0.5)" stroke-width="2" />
                <text x="100" y="40" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">indexing</text>
              </g>

              <!-- Node: ready -->
              <g transform="translate(100, 300)">
                <rect width="200" height="70" rx="35" fill="url(#grad-success)" stroke="rgba(0, 255, 136, 0.5)" stroke-width="2" />
                <text x="100" y="40" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">ready</text>
              </g>

              <!-- Node: failed -->
              <g transform="translate(500, 300)">
                <rect width="200" height="70" rx="35" fill="url(#grad-error)" stroke="rgba(255, 0, 85, 0.5)" stroke-width="2" />
                <text x="100" y="40" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">failed</text>
              </g>

              <!-- Node: sync_completed -->
              <g transform="translate(100, 450)">
                <rect width="200" height="70" rx="35" fill="url(#grad-success)" stroke="rgba(0, 255, 136, 0.3)" stroke-width="2" />
                <text x="100" y="40" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">sync_completed</text>
              </g>

              <!-- Node: requires_reindex -->
              <g transform="translate(500, 450)">
                <rect width="200" height="70" rx="35" fill="url(#grad-warn)" stroke="rgba(255, 170, 0, 0.5)" stroke-width="2" />
                <text x="100" y="40" fill="#fff" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle">requires_reindex</text>
              </g>
            </svg>
          </div>

        </div>
        <div class="grid-2">
          <article class="card">
            <h3>Fingerprint Fields</h3>
            <p>
              <code
                >{ embeddingProvider, embeddingModel, embeddingDimension,
                vectorStoreProvider, schemaVersion
                }</code
              >
            </p>
          </article>
          <article class="card">
            <h3>Safety Result</h3>
            <p>
              Prevents silent reads from incompatible embedding
              models/dimensions or schema-mode mismatches.
            </p>
          </article>
        </div>
      </section>

      <section class="section">
        <h2>Search And Sync Behavior</h2>
        <div class="details-list">
          <details>
            <summary>Search Pipeline</summary>
            <div class="details-body">
              <pre><code>freshness gate (search_codebase sync-on-read, ~3m staleness window)
  -> operator parse (lang:, path:, -path:, must:, exclude:)
       path operators use gitignore-style matching over normalized relative paths
  -> bounded candidate retrieval (SEARCH_MAX_CANDIDATES)
  -> deterministic filter precedence:
       scope -> lang -> path include -> path exclude -> must -> exclude
  -> rerank policy (docs scope skipped by default; graceful degradation on failure)
  -> changed-files boost (git status cache TTL ~5s, max changed-files threshold 50)
  -> grouping + diversity caps (deterministic relaxed pass)
  -> tie-break chain:
       score desc -> file asc -> start_line asc -> symbol label asc -> symbol id asc
  -> noise hint emission when visible top-K crosses noise threshold</code></pre>
            </div>
          </details>

          <details>
            <summary>Ignore Model</summary>
            <div class="details-body">
              <pre><code>ignore sources:
  .gitignore + .satoriignore + configured ignore patterns

reconcile flow:
  control-file signature change detected
    -> delete newly ignored indexed paths
    -> reload synchronizer
    -> forced incremental sync
    -> update signature/version
    -> coalesce concurrent reconcile requests</code></pre>
              <p class="intro">
                Non-watcher convergence is still guaranteed via signature checks
                during <code>ensureFreshness</code>.
              </p>
            </div>
          </details>

          <details>
            <summary>Capability Resolver + Rerank</summary>
            <div class="details-body">
              <pre><code>capability profile (fast / standard / slow)
  -> default and max search limits
  -> rerank policy decision
  -> docs scope skips rerank by policy in current public surface
  -> no public useReranker override knob</code></pre>
              <p class="intro">
                If rerank is attempted and fails, responses degrade with
                <code>RERANKER_FAILED</code> warnings and deterministic ordering
                is preserved.
              </p>
            </div>
          </details>

          <details>
            <summary>Incremental Sync</summary>
            <div class="details-body">
              <pre><code>stat-first scan (size + mtime signature)
  -> reuse prior hash when unchanged
  -> hash bytes only for changed/new candidates
  -> deterministic merkleRoot from sorted (relativePath, hash)
  -> diff {added, removed, modified}
  -> apply vector updates incrementally</code></pre>
              <p class="intro">
                Partial scans preserve prior entries for unreadable files/dirs
                to avoid false removals; true removals under unreadable prefixes
                are delayed until readability returns.
              </p>
            </div>
          </details>
        </div>
      </section>

      <section class="section">
        <h2>Transcript-Style Agent Calls</h2>
        <p class="intro">
          Representative MCP calls and output shape from real usage patterns.
        </p>
        <div style="margin: 2rem 0 1rem 0">
          <button class="btn copy-btn" data-copy="trace-block">
            Copy Trace
          </button>
        </div>
        <pre
          style="margin-top: 0"
        ><code id="trace-block">Called satori.list_codebases({})
Called satori.manage_index({"action":"status","path":"/home/hamza/repo/tradingview_ratio"})
-> sync completed | +0 added, -0 removed, ~0 modified

Called satori.search_codebase({"path":"/home/hamza/repo/tradingview_ratio","query":"auth refresh token flow","scope":"runtime","resultMode":"grouped","groupBy":"symbol","limit":5})
-> Hit: src/auth/session.ts:88-141
-> callGraphHint.symbolRef: {"file":"src/auth/session.ts","symbolId":"sym_auth_refresh"}

Called satori.call_graph({"path":"/home/hamza/repo/tradingview_ratio","symbolRef":{"file":"src/auth/session.ts","symbolId":"sym_auth_refresh"},"direction":"both","depth":2,"limit":20})
-> nodes: 6, edges: 8, notes: 1

Called satori.file_outline({"path":"/home/hamza/repo/tradingview_ratio","file":"src/auth/session.ts","limitSymbols":50})
-> 12 symbols resolved | spans locked

Called satori.read_file({"path":"src/auth/session.ts","open_symbol":"refreshToken","mode":"annotated"})
-> lines 88-141 | outlineStatus: ok | no warnings

File not found recovery:
Called satori.search_codebase({"path":"/home/hamza/repo/tradingview_ratio","query":"INVARIANTS.md canonical path","scope":"docs","resultMode":"raw","limit":10})
Called satori.read_file({"path":"/home/hamza/repo/tradingview_ratio/docs/INVARIANTS.md","start_line":480,"end_line":620,"mode":"annotated"})</code></pre>
      </section>

      <footer class="footer">
        <span
          >Landing: <a href="index.html">index.html</a> · Source:
          <a href="https://github.com/ham-zax/satori" target="_blank"
            >github.com/ham-zax/satori</a
          >
          · Docs:
          <a
            href="https://github.com/ham-zax/satori/blob/main/README.md"
            target="_blank"
            >README.md</a
          ></span
        >
        <span
          >This page describes behavior. If it’s here, there should be a test
          for it. · <a href="index.html">Back to Landing</a></span
        >
      </footer>
    </div>

    <script>
      const copyButtons = document.querySelectorAll(".copy-btn");
      copyButtons.forEach((btn) => {
        btn.addEventListener("click", async () => {
          const id = btn.getAttribute("data-copy");
          const source = document.getElementById(id);
          if (!source) return;
          const previous = btn.textContent;
          try {
            await navigator.clipboard.writeText(source.textContent);
            btn.textContent = "Copied";
          } catch {
            btn.textContent = "Copy failed";
          }
          setTimeout(() => {
            btn.textContent = previous;
          }, 1100);
        });
      });
    </script>
  </body>
</html>
